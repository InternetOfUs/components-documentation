openapi: 3.0.1
info:
  title: WeNet - Common models
  description: This document collects all the models common to the various components of the platform.

  contact:
    email: carlo.caprini@u-hopper.com
  version: 2.1.0

components:
  schemas:
    CreateUpdateTsDetails:
      type: object
      properties:
        _creationTs:
          type: integer
          readOnly: true
          description: The UTC epoch timestamp representing the creation instant.
          example: 1563871899
          minimum: 0
        _lastUpdateTs:
          type: integer
          readOnly: true
          description: The UTC epoch timestamp representing the last update instant.
          example: 1563898764
          minimum: 0

    NormOperator:
      type: string
      description: The operator of the norm
      enum:
        - EQUALS
        - LESS_THAN
        - GREATER_THAN
        - LESS_EQ_THAN
        - GREATER_EQ_THAN

    Norm:
      type: object
      properties:
        id:
          type: string
          description: The identifier of the norm
          example: 15837028-645a-4a55-9aaf-ceb846439eba
          readOnly: true
        attribute:
          type: string
          description: The name of the attribute whose value the norm should be compared to
          example: "has_car"
        operator:
          $ref: "#/components/schemas/NormOperator"
        comparison:
          type: string
          description: The norm value for the comparison
          example: true
        negation:
          type: boolean
          description: Specified if a negation operator should be applied
          example: true
          default: true

    # User profile

    PlannedActivity:
      type: object
      properties:
        id:
          type: string
          description: The identifier of the activity
          readOnly: true
          example: hfdsfs888
        startTime:
          type: string
          format: date-time
          description: The starting time of the activity
          example: 2019-07-21T14:30:00Z
          nullable: true
          minimum: 0
        endTime:
          type: string
          format: date-time
          description: The ending time of the activity
          example: 2019-07-21T15:30:00Z
          nullable: true
          minimum: 0
        description:
          type: string
          description: The description of the activity
          example: A few beers for relaxing
          nullable: true
        attendees:
          type: array
          nullable: true
          items:
            type: string
            description: The identifier of other wenet user taking part to the activity
            example: 15d85f1d-b1ce-48de-b221-bec9ae954a88
        status:
          type: string
          nullable: true
          description: The current status of the activity
          enum:
            - confirmed
            - tentative
            - cancelled
            - null
          example: confirmed

    RelevantLocation:
      type: object
      description: A location of interest for the user - may be the home or work location -. This information is generated by the platform AI.
      properties:
        id:
          type: string
          description: The identifier of the location
          readOnly: true
          example: kdjfghd8hikdfg
        label:
          type: string
          description: The descriptor of the location
          example: Home
          nullable: true
        latitude:
          type: number
          description: The latitude of the location
          example: 40.388756
          nullable: true
          minimum: -90
          maximum: 90
        longitude:
          type: number
          description: The latitude of the location
          example: -3.588622
          nullable: true
          minimum: -180
          maximum: 180

    Material:
      type: object
      description: It describes an object that is available to a user
      properties:
        name:
          type: string
          description: The name of the object
          example: car
          nullable: true
        description:
          type: string
          description: A description of the object
          example: Fiat 500
          nullable: true
        quantity:
          type: integer
          description: The amount of units available
          example: 1
          nullable: true
          minimum: 1
        classification:
          type: string
          nullable: true
          description: The classification used for representing the object

            - Global Product Classification (https://www.gs1.org/standards/gpc)

            - NICE classification (Classification of Goods and Services)
          example: nice

    Competence:
      type: object
      description: It describe a competence of a user
      properties:
        name:
          type: string
          description: The name of the competence
          example: language_Italian_C1
          nullable: true
        ontology:
          type: string
          description: The identifier of the competence
          example: esco
          nullable: true
        level:
          type: number
          description: The identifier of the competence (value in between 0 and 1, both included)
          example: 0.8
          nullable: true
          minimum: 0
          maximum: 1

    Meaning:
      type: object
      description: For defining more general purpose concepts
      properties:
        name:
          type: string
          description: The name of the concept represented by the meaning
          example: extraversion
          nullable: true
        category:
          type: string
          description: The category associated to the menaing
          example: big_five
          nullable: true
        level:
          type: number
          description: The level associated to the concept
          example: 0.8
          nullable: true

    SocialPractice:
      type: object
      properties:
        id:
          type: string
          description: The identifier of the social practice
          readOnly: true
          example: f9dofgljdksdf
        label:
          type: string
          description: The descriptor of the social practice
          example: commuter
          nullable: true
        materials:
          type: array
          nullable: true
          items:
            $ref: "#/components/schemas/Material"
        competences:
          type: array
          nullable: true
          items:
            $ref: "#/components/schemas/Competence"
        norms:
          type: array
          nullable: true
          description: The norms of the social practice
          items:
            $ref: "#/components/schemas/ProtocolNorm"

    SocialNetworkRelationship:
      type: object
      properties:
        appId:
          type: string
          description: The identifier of the application where the relation happens
          example: 4
          nullable: true
        sourceId:
          type: string
          description: The identifier of the WeNet user that is the source of the relationship
          example: 1
          nullable: true
        targetId:
          type: string
          description: The identifier of the WeNet user the relationship is related to the source
          example: 2
          nullable: true
        type:
          type: string
          nullable: true
          description: The relationship type
          enum:
            - friend
            - colleague
            - follower
            - family
            - acquaintance
            - null
          example: friend
        weight:
          type: number
          nullable: true
          description: A number from 0 to 1 that indicates the strength of the relation. 0 indicates a deleted/non-exisiting relation.
          example: 0.2
          minimum: 0
          maximum: 1

    Label:
      type: object
      description: label
      properties:
        name:
          type: string
          description: name of the label
          nullable: true
        semantic_class:
          type: number
          description: number that represent the category of the label
          nullable: true
        latitude:
          type: number
          description: latitude of the label for the user
          nullable: true
          minimum: -90
          maximum: 90
        longitude:
          type: number
          description: longitude of the label for the user
          nullable: true
          minimum: -180
          maximum: 180

    ScoredLabel:
      type: object
      description: Label with score
      properties:
        label:
          nullable: true
          $ref: "#/components/schemas/Label"
        score:
          type: number
          nullable: true
          description: score of the label
    Routine:
      type: object
      description: "Labels distribution for a given user, time and weekday"
      properties:
        user_id:
          type: string
          description: id of the user
          nullable: true
        weekday:
          type: string
          description: day of the week
          nullable: true
        label_distribution:
          description: "Time slots"
          type: object
          nullable: true
          additionalProperties:
            description: "Distribution of the labels"
            nullable: true
            type: array
            items:
              $ref: "#/components/schemas/ScoredLabel"
        confidence:
          type: number
          description: confidence of the result
          nullable: true

    CoreWeNetUserProfile:
      type: object
      properties:
        name:
          type: object
          nullable: true
          properties:
            first:
              type: string
              description: The first name of the user
              example: John
              nullable: true
            middle:
              type: string
              description: The middle name of the user
              example: Francis
              nullable: true
            last:
              type: string
              description: The last name of the user
              example: Doe
              nullable: true
            prefix:
              type: string
              description: The name prefix
              example: Dr.
              nullable: true
            suffix:
              type: string
              description: The suffix of the name
              example: Jr.
              nullable: true
        dateOfBirth:
          type: object
          nullable: true
          properties:
            year:
              type: integer
              example: 1976
              description: The year of birth
              nullable: true
              minimum: 1903
            month:
              type: integer
              example: 4
              description: "The month of birth, from 1 to 12 (1: Jan and 12: Dec)"
              nullable: true
              minimum: 1
              maximum: 12
            day:
              type: integer
              example: 23
              description: The day of the month
              nullable: true
              minimum: 1
              maximum: 31
        gender:
          type: string
          nullable: true
          enum:
            - M
            - F
            - O
            - non-binary
            - not-say
            - null
          example: F
        email:
          type: string
          description: The user email
          format: email
          example: john.doe@gmail.com
          nullable: true
        phoneNumber:
          type: string
          description: The user phone number
          example: +34 6888233133
          nullable: true
        locale:
          type: string
          description: The locale of the user
          example: es_ES
          nullable: true
        avatar:
          type: string
          description: The url to the image avatar
          nullable: true
        nationality:
          type: string
          description: The nationality of the user
          example: Spanish
          nullable: true
        occupation:
          type: string
          description: The occupation of the user
          example: nurse
          nullable: true
        hasLocations:
          type: boolean
          description: This is true if the platform has any localization data about the user.
          example: false
          nullable: true

    WeNetUserProfile:
      allOf:
        - $ref: "#/components/schemas/CoreWeNetUserProfile"
        - $ref: "#/components/schemas/CreateUpdateTsDetails"
      properties:
        id:
          type: string
          nullable: true
          description: The identifier of the WeNet user
          example: 15837028-645a-4a55-9aaf-ceb846439eba
        norms:
          type: array
          nullable: true
          description: The individual norms of the user
          items:
            $ref: "#/components/schemas/ProtocolNorm"
        plannedActivities:
          type: array
          nullable: true
          items:
            $ref: "#/components/schemas/PlannedActivity"
        relevantLocations:
          type: array
          nullable: true
          items:
            $ref: "#/components/schemas/RelevantLocation"
        personalBehaviors:
          type: array
          nullable: true
          items:
            $ref: "#/components/schemas/Routine"
        materials:
          type: array
          nullable: true
          items:
            $ref: "#/components/schemas/Material"
        competences:
          type: array
          nullable: true
          items:
            $ref: "#/components/schemas/Competence"
        meanings:
          type: array
          nullable: true
          items:
            $ref: "#/components/schemas/Meaning"

    # Tasks

    TaskType:
      type: object
      description: The component that describe a possible task
      allOf:
        - $ref: "#/components/schemas/CreateUpdateTsDetails"
        - $ref: "#/components/schemas/HumanDescription"
      properties:
        id:
          type: string
          description: The unique identifier of the task type
          nullable: true
          example: b129e5509c9bb79
        attributes:
          type: object
          nullable: true
          description: OpenAPI description of the attributes that can have a task.
        transactions:
          type: object
          nullable: true
          description: OpenAPI description of the transaction actions that can be done on the task.
        callbacks:
          type: object
          nullable: true
          description: OpenAPI description of the callbacks messages that can be send to the participants of the task.
        norms:
          type: array
          description: The norms that describe the protocol to follow the task of this type.
          nullable: true
          items:
            $ref: "#/components/schemas/ProtocolNorm"

    HumanDescription:
      description: The attributes used to identify and describe a model for an human.
      properties:
        name:
          type: string
          description: A name that identify the model.
          example: Eat together task
          nullable: true
        description:
          type: string
          description: A human readable description of the model.
          example: A task for organizing social dinners
          nullable: true
        keywords:
          type: array
          description: The keywords that describe the model.
          nullable: true
          example:
            - social interaction
            - eat
          items:
            type: string

    ProtocolNorm:
      type: object
      description: The description of a rule that has to follow by the wenet users
      properties:
        description:
          type: string
          description: A human readable description of the norm.
          example: Notify to all the participants that the task is closed.
          nullable: true
        whenever:
          type: string
          description: The conditions that fires this norm.
          example: is_received_do_transaction('close',Reason) and not(is_task_closed()) and get_profile_id(Me) and get_task_requester_id(RequesterId) and =(Me,RequesterId) and get_participants(Participants)
          nullable: true
        thenceforth:
          type: string
          description: The action to do if the conditions are satisfied.
          example: add_message_transaction() and close_task() and send_messages(Participants,'close',Reason)
          nullable: true
        ontology:
          type: string
          description: The ontology used on the norms.
          example: get_participants(P) :- get_task_state_attribute(UserIds,'participants',[]), get_profile_id(Me), wenet_remove(P,Me,UserIds).
          nullable: true

    Task:
      allOf:
        - $ref: "#/components/schemas/CreateUpdateTsDetails"
      description: A wenet task
      properties:
        id:
          type: string
          description: The unique identifier of the task
          readOnly: true
          example: b129e5509c9bb79
        taskTypeId:
          type: string
          description: The identifier of the task type associated to the task
          example: b129e5509c9bb79
          nullable: true
        appId:
          type: string
          description: The identifier of the aplication where the task is done
          nullable: true
          example: b129e5509c9bb79
        communityId:
          type: string
          description: The identifier of the community in which the task is going to be shared
          nullable: true
          example: b129e5509c9bb79
        requesterId:
          type: string
          description: The identifier of the WeNet user who created the task
          example: 15837028-645a-4a55-9aaf-ceb846439eba
          nullable: true
        goal:
          type: object
          description: The explanation of the task objective.
          nullable: true
          allOf:
            - $ref: "#/components/schemas/HumanDescription"
        closeTs:
          type: integer
          description: The UTC epoch timestamp representing the time the task is closed. It is `null` as long as the task is not closed.
          nullable: true
          example: 1563930000
          minimum: 0
        norms:
          type: array
          nullable: true
          description: The set of norms that define the interaction of the user when do the task
          items:
            $ref: "#/components/schemas/ProtocolNorm"
        attributes:
          nullable: true
          type: object
          description: The set of attributes that define the task
        transactions:
          nullable: true
          type: array
          items:
            $ref: "#/components/schemas/TaskTransaction"

    Message:
      type: object
      properties:
        appId:
          type: string
          description: ID of the Wenet application related to the message
          example: 822jhluNZP
          nullable: true
        receiverId:
          type: string
          description: The Wenet user ID of the recipient of the message
          example: a6822c47-f1b8-4c21-80bd-1d025266c3c7
          nullable: true
        label:
          type: string
          description: The type of the message
          example: TaskVolunteerNotification
          nullable: true
        attributes:
          type: object
          description: the attributes of the message, as key-value pairs.
          nullable: true

    TaskTransaction:
      allOf:
        - $ref: "#/components/schemas/CreateUpdateTsDetails"
      description: A task transition
      properties:
        id:
          description: The unique identified of the transaction
          example: 9dihugkdjfgndfg
          type: string
          readOnly: true
        taskId:
          description: The identifier of the WeNet task where the transaction is done
          example: b129e5509c9bb79
          type: string
          nullable: false
        label:
          type: string
          description: The label that identify the transaction to do
          nullable: false
        attributes:
          type: object
          description: The attributes that parameterize the transaction
          nullable: true
        actioneerId:
          description: The identifier of the user that want to change the task
          example: b129e5509c9bb79
          nullable: true
          type: string
        messages:
          type: array
          description: The list of messages that has provokes the execution of this task transaction
          nullable: true
          items:
            $ref: "#/components/schemas/Message"

    CommunityProfile:
      allOf:
        - $ref: "#/components/schemas/CreateUpdateTsDetails"
        - $ref: "#/components/schemas/HumanDescription"
      properties:
        id:
          type: string
          description: The identifier of the community.
          example: 15837028-645a-4a55-9aaf-ceb846439eba
          nullable: true
        appId:
          type: string
          description: The identifier of the application where the community is defined.
          example: 15837028-645a-4a55-9aaf-ceb846439eba
          nullable: true
        members:
          nullable: true
          type: array
          description: The members of the community.
          items:
            $ref: "#/components/schemas/CommunityMember"
        socialPractices:
          nullable: true
          type: array
          description: The social practice that are done into the community
          items:
            $ref: "#/components/schemas/SocialPractice"
        taskTypeIds:
          nullable: true
          type: array
          description: The identifiers of the allowed task types to do on the community
          items:
            type: string
        norms:
          nullable: true
          type: array
          description: The norms that regulates the community.
          items:
            $ref: "#/components/schemas/ProtocolNorm"
      description: A community of WeNet users.

    CommunityMember:
      allOf:
        - $ref: "#/components/schemas/CreateUpdateTsDetails"
      properties:
        userId:
          type: string
          description: The identifier of the user that is on the community.
          example: 15837028-645a-4a55-9aaf-ceb846439eba
          nullable: true
        privileges:
          type: array
          description: The keywords that describe the community.
          nullable: true
          items:
            type: string
      description: A member of a community.

    Incentive:
      type: object
      required:
        - AppID
        - UserId
        - IncentiveType
        - Issuer
      properties:
        AppID:
          type: string
          example: 1
        UserId:
          type: string
          example: 6
        IncentiveType:
          type: string
          example: Message/Badge (only one)
        Issuer:
          type: string
          example: WeNet issuer
        Message:
          type: object
          nullable: true
          properties:
            content:
              type: string
              example: >-
                we are happy to see your participation in the I-log app you are
                doing a great job!
        Badge:
          type: object
          nullable: true
          properties:
            BadgeClass:
              type: string
              example: hpqAdI7hQf2maQ13AW1jXA
            ImgUrl:
              type: string
              example: >-
                http://3.126.161.118:8000/media/uploads/badges/assertion-OYmfmtDFSIKG-qeZfXz4QQ.png
            Criteria:
              type: string
              example: The user will get this badge for 50 relations in tweeter.
            Message:
              type: string
              example: >-
                congratulations! you just earned a new badge for your relations
                on Twitter.

    VolunteerForTaskTransaction:
      type: object
      description: Task transaction that says that a new volunteer has applied to a task
      properties:
        id:
          description: The unique identified of the transaction
          example: 9dihugkdjfgndfg
          type: string
          nullable: false
          readOnly: true
        taskId:
          description: The unique identifier of the task this transaction is associated to
          example: b129e5509c9bb79
          type: string
        label:
          type: string
          enum:
            - volunteerForTask
          description: The label associated to the transaction type
        attributes:
          type: object
          description: The attributes that are set in the associated transaction type
        actioneerId:
          description: The identifier of the user that applied to the task
          example: b129e5509c9bb79
          nullable: false
          type: string

    RefuseTaskTransaction:
      type: object
      description: Task transaction that says that a volunteer has refused to apply to a task
      properties:
        id:
          description: The unique identified of the transaction
          example: 9dihugkdjfgndfg
          type: string
          nullable: false
          readOnly: true
        taskId:
          description: The unique identifier of the task this transaction is associated to
          example: b129e5509c9bb79
          type: string
        label:
          type: string
          enum:
            - refuseTask
          description: The label associated to the transaction type
        attributes:
          type: object
          description: The attributes that are set in the associated transaction type
        actioneerId:
          description: The identifier of the user that refused to apply for the task
          example: b129e5509c9bb79
          nullable: false
          type: string

    AcceptedVolunteerTransaction:
      type: object
      description: Task transaction that says that a volunteer has been accepted to participate to the task
      properties:
        id:
          description: The unique identified of the transaction
          example: 9dihugkdjfgndfg
          type: string
          nullable: false
          readOnly: true
        taskId:
          description: The unique identifier of the task this transaction is associated to
          example: b129e5509c9bb79
          type: string
        label:
          type: string
          enum:
            - acceptVolunteer
          description: The label associated to the transaction type
        attributes:
          type: object
          description: The attributes that are set in the associated transaction type
          properties:
            volunteerId:
              description: The ID of the volunteer that is being accepted to the task
              type: string
              example: d353Sdt3E
        actioneerId:
          description: The identifier of the user that want to change the task
          example: b129e5509c9bb79
          nullable: false
          type: string

    RefusedVolunteerTransaction:
      type: object
      description: Task transaction that says that a volunteer has been refused to participate to the task
      properties:
        id:
          description: The unique identified of the transaction
          example: 9dihugkdjfgndfg
          type: string
          nullable: false
          readOnly: true
        taskId:
          description: The unique identifier of the task this transaction is associated to
          example: b129e5509c9bb79
          type: string
        label:
          type: string
          enum:
            - refuseVolunteer
          description: The label associated to the transaction type
        attributes:
          type: object
          description: The attributes that are set in the associated transaction type
          properties:
            volunteerId:
              description: The ID of the volunteer that is being refused to the task
              type: string
              example: d353Sdt3E
        actioneerId:
          description: The identifier of the user that want to change the task
          example: b129e5509c9bb79
          nullable: false
          type: string

    TaskCompletedTransaction:
      type: object
      description: Task transaction that says that the task is completed
      properties:
        id:
          description: The unique identified of the transaction
          example: 9dihugkdjfgndfg
          type: string
          nullable: false
          readOnly: true
        taskId:
          description: The unique identifier of the task this transaction is associated to
          example: b129e5509c9bb79
          type: string
        label:
          type: string
          enum:
            - taskCompleted
          description: The label associated to the transaction type
        attributes:
          type: object
          description: The attributes that are set in the associated transaction type
          properties:
            outcome:
              description: A description of the outcome of the task
              type: string
              enum:
                - completed
                - cancelled
                - failed
        actioneerId:
          description: The identifier of the user that want to change the task
          example: b129e5509c9bb79
          nullable: false
          type: string
